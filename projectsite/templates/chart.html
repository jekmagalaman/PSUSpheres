{% extends 'base.html' %} {% load static %} {% block content %}
<div class="page-inner">
  <h4 class="page-title">Dashboard</h4>
  <div class="row">

    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <div class="card-title">Pie Chart</div>
        </div>
        <div class="card-body">
          <div class="chart-container">
            <canvas id="pieChart" style="width: 400px; height: 400px;"></canvas>
            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <div class="card-title">Multiple Line Chart</div>
        </div>
        <div class="card-body">
          <div class="chart-container">
            <canvas id="multipleLineChart"></canvas>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <div class="card-title">Multiple Bar Chart</div>
        </div>
        <div class="card-body">
          <div class="chart-container">
            <canvas id="multipleBarChart"></canvas>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <div class="card-title">Line Chart</div>
        </div>
        <div class="card-body">
          <div class="chart-container">
            <canvas id="lineChart"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block chart %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    function loadChartData() {
      // Pie Chart
      fetch("/chart/")
        .then((response) => response.json())
        .then((data) => {
          console.log("Received data for pie chart:", data);  // Check if data is correct

          if (Array.isArray(data) && data.length > 0) {
            var severityLevels = data.map(entry => entry.name);
            var counts = data.map(entry => entry.count);
            var pieChart = document.getElementById("pieChart").getContext("2d");

            new Chart(pieChart, {
              type: "pie",
              data: {
                datasets: [
                  {
                    data: counts,
                    backgroundColor: ["#1d7af3", "#f3545d", "#fdaf4b"],
                    borderWidth: 0,
                  },
                ],
                labels: organization,
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                legend: {
                  position: "bottom",
                  labels: {
                    fontColor: "rgb(154, 154, 154)",
                    fontSize: 11,
                    usePointStyle: true,
                    padding: 20,
                  },
                },
                pieceLabel: {
                  render: "percentage",
                  fontColor: "white",
                  fontSize: 14,
                },
                tooltips: false,
                layout: {
                  padding: {
                    left: 20,
                    right: 20,
                    top: 20,
                    bottom: 20,
                  },
                },
              },
            });
          } else {
            console.error("Invalid data format for pie chart.");
          }
        })
        .catch((error) => console.error("Error fetching data for pie chart:", error));
    }

    loadChartData();
  });
</script>
{% endblock %}

